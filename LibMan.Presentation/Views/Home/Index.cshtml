@model PagedResult<Book>

<!-- Header-->
<header class="bg-dark py-1">
	<div class="container px-4 px-lg-5 my-1">
		<div class="text-center text-white">
			<h1 class="display-4 fw-bolder">Welcome to the library!</h1>
			<p class="lead fw-normal text-white-50 mb-0">For all your book needs</p>
		</div>
	</div>
</header>

<div id="filteredBooks" class="mt-3">
	@await Html.PartialAsync("_BooksPartial", Model)
</div>

@section Scripts
{
	<script>
		const updateBooks = selectedStatuses => {
			const pageNumber = 1;

			const query = new URLSearchParams();
			query.append("pageNumber", pageNumber);
			selectedStatuses.forEach(status => query.append("statuses", status));

			const url = `/Home/FilterBooksAjax?${query.toString()}`;

			fetch(url)
				.then(res => res.text())
				.then(data => {
					document.getElementById("filteredBooks").innerHTML = data;

					selectedStatuses.forEach(status => {
						document.querySelectorAll(`.status-filter[data-status="${status}"]`).forEach(cb => cb.checked = true);
					});

					attachCheckboxListeners();
				})
				.catch(error => console.error("Error fetching filtered data: ", error))
		};

		const attachCheckboxListeners = () => {
			document.querySelectorAll(".status-filter").forEach(checkbox => {
				checkbox.addEventListener("change", () => {
					const selectedStatuses = Array.from(document.querySelectorAll(".status-filter:checked"))
												  .map(cb => cb.dataset.status);
					updateBooks(selectedStatuses);
				});
			});
		};

		document.addEventListener("DOMContentLoaded", attachCheckboxListeners);
	</script>
}